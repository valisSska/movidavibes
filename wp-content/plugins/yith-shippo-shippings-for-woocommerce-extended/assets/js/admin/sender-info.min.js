jQuery((function(e){var i={onboardingValidation:!0,template:void 0!==wp.template?wp.template("yith-shippo-sender"):null,modal:!1,selector:{addSenderButton:e(document).find("button.yith-shippo-add-sender"),mainButton:"#main-save-button",mainBox:".single-sender-info-wrapper",mainForm:"#plugin-fw-wc",editSender:".action__edit",deleteSender:".action__trash",setDefault:".set-default"},initFields:function(){"undefined"!=typeof selectWoo&&e("#yith-shippo-sender-info-country_state").selectWoo()},init:function(){this.initFields(),this.selector.addSenderButton.length>0&&e(document).find("form h2").append(this.selector.addSenderButton),e("table#sender-info").length>0&&e("p.submit, #yith-plugin-fw-float-save-button, #plugin-fw-wc-reset").hide(),e(document).on("change","#yith-shippo-sender-use_wc_address",this.fillAddress),e(document).find("#yith-shippo-sender-use_wc_address").change(),e(document).on("click",this.selector.mainButton,this.validateSenderInfo),e(document).on("click",".yith-plugin-fw__modal__main #yith-shippo-save-sender",this.validateSenderInfo),e(document).on("click","button.yith-shippo-add-sender",this.addSender),e(document).on("click",this.selector.editSender,this.editSender),e(document).on("click",this.selector.deleteSender,this.deleteSender),e(document).on("click",this.selector.setDefault,this.setDefault),e(document).on("yith_onboarding_form_submit_validation",this.onboardingNeedValidation.bind(this)),e(document).on("yith_onboarding_validate_form_submit",this.onboardingValidate.bind(this))},onboardingNeedValidation:function(){return this.onboardingValidation},onboardingValidate:function(t,n){var o=i.checkEmptyFields();if(!o)var a=this.checkValidEmail(e("#yith-shippo-sender-info-email"));!o&&a&&(this.onboardingValidation=!1,n.submit())},block:function(e){e.block({message:"",overlayCSS:{backgroundColor:"#FFFFFF",opacity:.8,cursor:"wait"}})},unblock:function(e){e.unblock()},fillAddress:function(t){if(t.preventDefault(),t.stopImmediatePropagation(),e(document).find("#yith-shippo-sender-use_wc_address").is(":checked")){var n=yith_shippo_sender_info_params.woocommerce_shop_base_info;for(var o in console.log(n),n)e(document).find("#yith-shippo-sender-info-"+o).val(n[o]).attr("disabled",!0).change()}else e(document).find(".yith-shippo-sender-wrap input",".yith-shippo-sender-wrap select").attr("disabled",!1),e(document).find(".yith-shippo-sender-wrap select").attr("disabled",!1);i.initFields()},checkEmptyFields:function(){var i=!1;return document.querySelectorAll(".yith-shippo-validate").forEach((function(t){let n=e(t).closest(".yith-single-text").find(".empty-field");""===e(t).val()?(i=!0,n.length||e("<span class='empty-field description'>"+yith_shippo_sender_info_params.emptyField+"</span>").insertAfter(e(t)),n.show(),e(t).addClass("is-empty")):(n.hide(),e(t).removeClass("is-empty"))})),i},checkValidEmail:function(i){var t=!1;return e(i).val().match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/)?t=!0:e("<span class='empty-field description'>"+yith_shippo_sender_info_params.invalidEmailField+"</span>").insertAfter(e(i)),t},validateSenderInfo:function(t){t.preventDefault(),t.stopImmediatePropagation();var n=i.checkEmptyFields(e(".yith-shippo-validate"));if(!n)var o=i.checkValidEmail(e("#yith-shippo-sender-info-email"));if(n||!o)return!1;var a=e(i.selector.mainBox),s=e(i.selector.mainForm);i.modal&&(s=a=e(document).find("#yith-shippo-sender-info-modal form")),i.block(a);var d=new FormData,r=s.serializeArray();e.each(r,(function(e,i){d.append(i.name,i.value)})),d.append("action",yith_shippo_sender_info_params.actions.validateSenderInfo),d.append("security",yith_shippo_sender_info_params.security.addSenderInfoNonce);var l=e("#yith-bh-onboarding").length>0;e.ajax({type:"POST",data:d,dataType:"json",contentType:!1,processData:!1,url:yith_shippo_sender_info_params.ajaxurl,success:function(t){if(t.success){if(l)return!0;i.modal?(e(document).find(".yith-shippo-sender-info").html(t.data),i.modal.close()):e(document).find(".yith-shippo-address-validation-error").html(t.data).removeClass("error").addClass("success")}else t.data&&e(document).find(".yith-shippo-address-validation-error").html(t.data).removeClass("success").addClass("error")},complete:function(){i.unblock(a)}})},addSender:function(t){t.preventDefault(),t.stopImmediatePropagation();var n=e(i.template({id:"shippo-"+Date.now(),edit:!1}));i.modal=yith.ui.modal({content:n,title:yith_shippo_sender_info_params.modal_title,width:510}),e("#yith-shippo-sender-info-shipping_zones input").attr("checked",!1),i.initFields()},editSender:function(t){t.preventDefault(),t.stopImmediatePropagation();var n=e(this).closest(".yith-shippo-sender-info"),o=n.data("item"),a=o.shipping_zones;o.edit=!0,o.id=n.data("id");var s=e(i.template(o)),d=s.find(".yith-plugin-fw-checkbox-array__row"),r=s.find(".yith-shipping-zone-select-all input");r.attr("checked",!1),d.each((function(){var i=e(this).find("input");i.attr("checked",!1),e(this).removeClass("selected");var t=i.val();for(var n of a)n===t&&(i.attr("checked",!0),e(this).addClass("selected"))})),d.length===a.length&&r.attr("checked",!0),i.modal=yith.ui.modal({content:s,title:yith_shippo_sender_info_params.modal_title,width:510}),e(document).find("#yith-shippo-sender-info-country_state").val(o.country_state),i.initFields()},deleteSender:function(t){t.preventDefault();var n=e("#sender-info"),o=e(this).closest("tr").data("id");yith.ui.confirm({title:yith_shippo_sender_info_params.delete_confirmation_title,message:yith_shippo_sender_info_params.delete_confirmation_message,confirmButtonType:"delete",closeAfterConfirm:!0,onConfirm:function(){i.block(n),e.ajax({type:"POST",url:yith_shippo_sender_info_params.ajaxurl,data:{id:o,security:yith_shippo_sender_info_params.security.deleteSenderInfoNonce,action:yith_shippo_sender_info_params.actions.deleteSenderInfo},success:function(i){i.success&&void 0!==i.data&&e(document).find(".yith-shippo-sender-info").html(i.data),void 0!==i.error&&console.log(i.error)}})}})},setDefault:function(t){t.preventDefault();var n=e("#sender-info"),o=e(this).closest("tr").data("id");i.block(n),e.ajax({type:"POST",url:yith_shippo_sender_info_params.ajaxurl,data:{id:o,security:yith_shippo_sender_info_params.security.setDefaultSenderInfoNonce,action:yith_shippo_sender_info_params.actions.setDefaultSenderInfo},success:function(i){i.success&&void 0!==i.data&&e(document).find(".yith-shippo-sender-info").html(i.data),void 0!==i.error&&console.log(i.error)}})}};i.init()}));