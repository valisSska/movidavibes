jQuery((function(e){var i={template:wp.template("yith-shippo-parcel"),parceList:e("#parcel-list"),mainContent:e(".yith-shippo-parcel-list"),shippoParcels:e(".yith-shippo-parcel-list").data("parcels"),modal:!1,dynamicFields:["width","length","height","name"],blockArgs:{message:"",overlayCSS:{backgroundColor:"#FFFFFF",opacity:.8,cursor:"wait"}},selector:{addParcelButton:".yith-shippo-add-parcel-box",checkAll:".yith-shippo-bulk-action-check",applyBulk:"#yith_shippo_bulk_parcels",triggerApplyBulk:"#yith_shippo_bulk_parcels_triggered",bulkActionSelect:"#yith-shippo-parcel-bulk-action",form:"#plugin-fw-wc",addParcelSubmit:"#yith-shippo-add-parcel-modal .submit",floatButton:"#yith-plugin-fw-float-save-button",parcelRow:".yith-shippo-parcel",editParcel:".yith-shippo-parcel .action__edit",activeParcel:".active input",deleteParcel:".action__trash"},fields:{},init:function(){this.initFields(),e(this.selector.floatButton).hide(),e(document).on("click",this.selector.addParcelButton,this.addParcel),e(document).on("click",this.selector.editParcel,this.editParcel),e(document).on("click",this.selector.checkAll,this.checkAllbulkItems),e(document).on("click",this.selector.applyBulk,this.triggerBulkAction),e(document).on("click",this.selector.addParcelSubmit,this.validateParcelBoxes),e(document).on("click",this.selector.activeParcel,this.activeParcel),e(document).on("click",this.selector.deleteParcel,this.deleteParcel)},initFields:function(){this.fields={parcelType:e(document).find(".parcel-type select"),bulkItems:e(document).find(".yith-shippo-bulk-single-action"),checkAll:e(document).find(".yith-shippo-bulk-action-check")},this.fields.parcelType.on("change",this.loadParcelInformation),e(document.body).trigger("wc-enhanced-select-init")},addParcel:function(t){t.preventDefault();var a=e(i.template({id:"shippo-"+Date.now(),edit:!1})).addClass("yith-shippo-new-parcel");i.modal=yith.ui.modal({content:a,title:yith_shippo_parcel_params.add_new_parcel_title}),i.initFields()},editParcel:function(t){t.preventDefault();var a=e(this).closest(".yith-shippo-parcel").data("item"),l=a.shipping_zones;a.id=a.ID,a.edit=!0;var o=e(i.template(a)).addClass("yith-shippo-new-parcel"),c=o.find(".yith-plugin-fw-checkbox-array__row"),n=o.find(".yith-shipping-zone-select-all input");n.attr("checked",!1),c.each((function(){var i=e(this).find("input");i.attr("checked",!1),e(this).removeClass("selected");var t=i.val();for(var a of l)a===t&&(i.attr("checked",!0),e(this).addClass("selected"))})),c.length===l.length&&n.attr("checked",!0),i.modal=yith.ui.modal({content:o,title:yith_shippo_parcel_params.edit_parcel_title}),i.initFields()},resetDynamicFields:function(t){for(var a of i.dynamicFields)e("#yith_shippo_parcel-"+t+"-"+a).val("").attr("disabled",!1)},loadParcelInformation:function(){var t=e(this).val(),a=e(this).closest("form").find("#parcel-id").val();if("parcel"!==t){var l=i.shippoParcels.filter((function(e){return e.token==t})).pop();if(l)for(var o=0;o<i.dynamicFields.length;o++)"name"!==i.dynamicFields[o]?e("#yith_shippo_parcel-"+a+"-"+i.dynamicFields[o]).val(l[i.dynamicFields[o]]).attr("disabled",!0):e("#yith_shippo_parcel-"+a+"-"+i.dynamicFields[o]).val(l.carrier+" "+l.name)}else i.resetDynamicFields(a)},checkAllbulkItems:function(){i.fields.bulkItems.attr("checked",e(this).is(":checked"))},triggerBulkAction:function(t){t.preventDefault(),t.stopPropagation(),window.onbeforeunload=null,"delete_parcel_boxes"===e(i.selector.bulkActionSelect).val()?yith.ui.confirm({title:yith_shippo_parcel_params.delete_confirmation_title,message:yith_shippo_parcel_params.delete_confirmation_message,confirmButtonType:"delete",closeAfterConfirm:!1,onConfirm:function(){e(i.selector.triggerApplyBulk).val(1),e(i.selector.form).submit()}}):(e(i.selector.triggerApplyBulk).val(1),e(i.selector.form).submit())},activeParcel:function(i){i.preventDefault();var t=e(this).closest("tr").data("id");e.ajax({type:"POST",url:yith_shippo_parcel_params.ajaxurl,data:{id:t,enabled:e(this).is(":checked"),security:yith_shippo_parcel_params.security.enableParcelNonce,action:yith_shippo_parcel_params.actions.enableParcel},success:function(e){void 0!==e.error&&console.log(e.error)}})},deleteParcel:function(t){t.preventDefault();var a=e(this).closest("tr").data("id");yith.ui.confirm({title:yith_shippo_parcel_params.delete_confirmation_title,message:yith_shippo_parcel_params.delete_confirmation_message,confirmButtonType:"delete",closeAfterConfirm:!0,onConfirm:function(){i.parceList.block(i.blockArgs),e.ajax({type:"POST",url:yith_shippo_parcel_params.ajaxurl,data:{id:a,security:yith_shippo_parcel_params.security.deleteParcelNonce,action:yith_shippo_parcel_params.actions.deleteParcel},success:function(e){e.success&&void 0!==e.data&&(i.mainContent.html(e.data),i.parceList.unblock(),i.initFields()),void 0!==e.error&&console.log(e.error)}})}})},validateParcelBoxes:function(t){t.preventDefault(),t.stopPropagation(),window.onbeforeunload=null;for(var a=e(document).find("#yith-shippo-add-parcel"),l=["width","length","height"],o=e(document).find("#parcel-id").val(),c=!1,n=0;n<l.length;n++){(r=e(document).find("#yith_shippo_parcel-"+o+"-"+l[n])).isNumeric()?r.removeClass("required"):(r.addClass("required"),c=r)}l=["weight","inner_padding","max_weight"];for(n=0;n<l.length;n++){var r,s=(r=e(document).find("#yith_shippo_parcel-"+o+"-"+l[n])).val();if(s){var p=s.replace(",",".");r.val(p)}}if(!c){var d=new FormData,h=e(a).serializeArray();e.each(h,(function(e,i){d.append(i.name,i.value)})),d.append("action",yith_shippo_parcel_params.actions.saveParcel),d.append("security",yith_shippo_parcel_params.security.saveParcelNonce),i.parceList.block(i.blockArgs),e.ajax({type:"POST",url:yith_shippo_parcel_params.ajaxurl,data:d,dataType:"json",contentType:!1,processData:!1,success:function(e){e.success&&void 0!==e.data&&(i.mainContent.html(e.data),i.parceList.unblock(),i.modal.close(),i.initFields()),void 0!==e.error&&console.log(e.error)}})}}};i.parceList.length>0&&i.init();var t={selector:{additionalWeight:"#yith_shippo_additional_weight",mainButton:"#main-save-button, #yith-plugin-fw-float-save-button",floatButton:"#yith-plugin-fw-float-save-button",form:"#plugin-fw-wc"},fields:{additionalWeightType:e("#yith_shippo_additional_weight_type")},init:function(){this.fields.additionalWeightType.on("change",this.switchAdditionalWeightType).trigger("change"),e("#yith_shippo_min_parcel_dimension").length>0&&(e(document).on("click",this.selector.mainButton,this.validateDefaultParcelBoxDimensions),e(document).on("click",this.selector.floatButton,this.validateDefaultParcelBoxDimensions))},switchAdditionalWeightType:function(){var i=t.fields.additionalWeightType,a=e(t.selector.additionalWeight).find(".fixed"),l=e(t.selector.additionalWeight).find(".percentage");"fixed"===i.val()?(l.hide(),a.show()):(l.show(),a.hide())},validateDefaultParcelBoxDimensions:function(i){i.preventDefault(),i.stopPropagation(),window.onbeforeunload=null;for(var a=["min-width","min-length","min-height","min-weight"],l=!1,o=0;o<a.length;o++){var c=e(document).find("#yith_shippo_min_parcel_dimension_"+a[o]);c.isNumeric()?c.removeClass("required"):(c.addClass("required"),l||(l=!0,c.scroll_to()))}l||e(t.selector.form).submit()}};t.init()}));