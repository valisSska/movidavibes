jQuery((function(i){var t=i("#yith-shippo-order-shippings");if(t.addClass("not-sortable"),i(".meta-box-sortables").sortable({items:":not(.not-sortable)"}),t.find(".postbox-header h2").off("click"),i(document).on("click",".yith-shippo-shipping-section-box--title,.yith-shippo-shipping-section-box--toggle",(function(t){t.stopImmediatePropagation();var e=i(t.target).closest(".yith-shippo-shipping-section-box"),o=e.find(".yith-shippo-shipping-section-box--content");e.is(".yith-shippo-shipping-section-box--closed")?o.slideDown(400):(o.css({display:"block"}),o.slideUp(400)),e.toggleClass("yith-shippo-shipping-section-box--closed")})),i("#yith-shippo-order-meta-box").hasClass("yith-shippo-hide-shipping-row")){var e=i("#yith-shippo-order-meta-box").data("order_item_id");i("#order_shipping_line_items").find('tr.shipping[data-order_item_id="'+e+'"]').hide()}var o=function(i,t){yith.ui.confirm({title:i,message:t,confirmButtonType:"confirm",confirmButton:yith_shippo_order_meta_box_params.errorButtonLabel,width:550,closeAfterConfirm:!0,classes:{cancel:"yith-shippo-hide-cancel-button"}})};i(document).on("click",".yith-shippo-tracking--check-for-updates",(function(t){t.preventDefault();var e=i(this).parents(".yith-shippo-shipping-section-box"),o=e.data("rate-key"),p={action:yith_shippo_order_meta_box_params.actions.updateTracking,security:yith_shippo_order_meta_box_params.nonces.updateTracking,order_id:i("#yith-shippo-order-meta-box").data("order_id"),rate_key:o};e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),i.ajax({type:"POST",url:yith_shippo_order_meta_box_params.ajaxurl,data:p,dataType:"json",success:function(t){i("#yith-shippo-order-meta-box").unblock(),t.success&&(e.find(".yith-shippo-shipping-section-box--content").html(t.data),e.unblock())}})})),i(document).on("click","#yith-shippo-add-new-shipping",(function(t){t.preventDefault();var e={action:yith_shippo_order_meta_box_params.actions.createShipping,security:yith_shippo_order_meta_box_params.nonces.createShipping,order_id:i("#yith-shippo-order-meta-box").data("order_id")};i("#yith-shippo-order-meta-box").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),i.ajax({type:"POST",url:yith_shippo_order_meta_box_params.ajaxurl,data:e,dataType:"json",success:function(t){if(i("#yith-shippo-order-meta-box").unblock(),t.success)i("#yith-shippo-order-meta-box").parent().html(t.data),i(document.body).trigger("wc-enhanced-select-init"),i(document).trigger("yith_fields_init"),i(document).trigger("yith-shippo-metabox-init");else{var e="";i.each(t.data,(function(i,t){e+="<li>"+t.message+"</li>"})),e="<ul>"+e+"</ul>",o(yith_shippo_order_meta_box_params.confirmShipment.title_error,e)}}})})),i(document).on("yith-shippo-metabox-init",(function(){var t=i("#yith-shippo-order-meta-box").data("order_configuration"),e=i("#yith-shippo-order-meta-box").data("items"),p=(i(".yith-shippo-order-shipping-list"),0),a=0,r={};i.each(t,(function(i,t){p+=parseInt(t.max_qty),a+=parseInt(t.max_qty)*parseFloat(t.cost)})),i.each(e,(function(t,e){i.each(e,(function(i,t){parseFloat(t.value),void 0===r[i]?(r[i]=parseInt(t.qty)):r[i]+=parseInt(t.qty)}))}));var s={template:wp.template("yith-shippo-product-list"),dom:{addNew:i(".yith_shippo_new_product")},_init_product_row:function(){i(".yith-shippo-product-shipping--row").each((function(){var t=i(this);s.init_single_product_row(t)}))},init_single_product_row:function(i){var o=i.find("input.yith-product-qty"),r=i.find("select.yith-shippo-product-list").val(),s=i.find("input.yith-product-price"),n=i.parents(".yith-shippo-shipping-section-box"),h=t[r];if(o.attr("disabled",!1),"all"!==r){var c=e[n.data("rate-key")];o.attr("max",h.max_qty),void 0!==c&&void 0!==c[r]?(o.val(c[r].qty),s.val(c[r].value)):(o.val(h.max_qty),s.val(parseFloat(h.cost)*h.max_qty))}else o.attr("max",p),s.val(a),o.val(p).attr("disabled",!0)},init:function(){this._init_product_row(),this.dom.addNew.on("click",this.addNewRule),i(document).on("click",".yith-shippo-remove-rule",this.removeRule),i(document).on("change","select.yith-shippo-product-list",this.handleProductSelectChange),i("select.yith-shippo-product-list").each((function(){s.handleProductSelectChange.call(i(this))}))},getSelectedItems:function(t){var e=t.find(".yith-shippo-product-shipping--row"),o=[];return e.each((function(){var t=i(this).find("select.yith-shippo-product-list").val();"all"!==t&&o.push(t)})),o},processNewProductList:function(t,e){return t.find("select.yith-shippo-product-list option").attr("disabled",!1),i.each(e,(function(i,e){t.find('select.yith-shippo-product-list option[value="'+e+'"]').attr("disabled",!0)})),t.find("select.yith-shippo-product-list option:not([disabled])").length?(t.find("select.yith-shippo-product-list option:selected").attr("selected",!1),t.find("select.yith-shippo-product-list option:not([disabled]):first").attr("selected",!0)):t=!1,t},addNewRule:function(t){t.preventDefault();var e=i(t.target).parents(".yith-plugin-fw-product-list-field-wrapper"),o=e.find(".yith-shippo-producs-shipping-list"),p=s.getSelectedItems(o),a=o.find(".yith-shippo-product-shipping--row").map((function(){return parseInt(i(this).attr("data-subindex"))})).get(),r=Math.max.apply(null,a)+1,n=i(s.template({index:r}));(n=s.processNewProductList(n,p))&&(o.append(n),i(document.body).trigger("wc-enhanced-select-init"),i(document).trigger("yith_fields_init"),s.handleProductSelectChange.call(n.find("select.yith-shippo-product-list"))),!1!==n&&1!==n.find("select.yith-shippo-product-list option:not([disabled])").length||e.find(".yith-shippo-new-product").hide()},removeRule:function(t){t.preventDefault();var e=i(this).parents(".yith-shippo-product-shipping--row");i(this).parents(".yith-plugin-fw-product-list-field-wrapper").find(".yith-shippo-new-product").show(),e.remove()},handleProductSelectChange:function(t){var e=!1;void 0!==t?e=i(t.target):i(this).length&&i(this).hasClass("yith-shippo-product-list")&&(e=i(this));var o=e.parents(".yith-shippo-product-shipping--row");"all"===e.val()?(o.parent().parent().find(".yith-shippo-new-product").hide(),o.parent().parent().find(".yith-product-qty").hide(),o.siblings().remove()):(e.find('option[value!="all"]').length!==o.parent().find(".yith-shippo-product-shipping--row").length&&o.parent().parent().find(".yith-shippo-new-product").show(),o.parent().parent().find(".yith-product-qty").show());s.init_single_product_row(o)}};s.init();var n={},h=null,c=function(t,e){var o=i(n[t]);""!==e&&(o.find(".yith-shippo-service-popup-row").removeClass("service-checked"),o.find('.yith-shippo-service-popup-row[data-service-id="'+e+'"]').addClass("service-checked")),h=yith.ui.modal({title:yith_shippo_order_meta_box_params.servicePopUp.title,content:o,closeWhenClickingOnOverlay:!0,allowClosingWithEsc:!0,showClose:!0,width:550,allowWpMenu:!1,allowWpMenuInMobile:!1})};i(document).on("click",".yith-shippo-edit-service,.yith-shippo-choose-service",(function(t){t.preventDefault(),t.stopImmediatePropagation();var e=i(this).parents(".yith-shippo-shipping-section-box"),p=i("#yith-shippo-order-shippings"),a=e.find(".yith_shippo_rate_key").val();if(p.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),void 0===n[a]||""===n[a]){var r=i(":input",e).serializeJSON(),s={};i.each(r["yith-shippo-shipping-metabox"],(function(t,e){i.each(e,(function(i,t){s[i]=t}))})),s.order_id=i("#yith-shippo-order-meta-box").data("order_id"),s.rate_key=a;var h={action:yith_shippo_order_meta_box_params.actions.findService,security:yith_shippo_order_meta_box_params.nonces.findService,rate:s};i.ajax({type:"POST",url:yith_shippo_order_meta_box_params.ajaxurl,data:h,dataType:"json",success:function(t){if(p.unblock(),t.success&&void 0!==t.data)e.parent().unblock(),n[a]=t.data,c(a,"");else{var r="";i.each(t.data,(function(i,t){r+="<li>"+t.message+"</li>"})),r="<ul>"+r+"</ul>",o(yith_shippo_order_meta_box_params.servicePopUp.title_error,r)}}})}else{p.unblock();var d=e.find(".yith-shippo-service-id").val();c(a,d)}})),i(document).on("click",".yith-shippo-service-popup-row",(function(t){t.preventDefault(),t.stopImmediatePropagation();var e=i("#yith-shippo-order-meta-box").data("order_id"),o=i(this),p=o.data("rate-key"),a=jQuery.parseJSON(o.data("rate")),r=o.parent().data("parcel"),s=i(document).find("#yith-shippo-order-meta-box"),n=s.find('.yith-shippo-shipping-section-box[data-rate-key="'+p+'"]');s.block({message:"",overlayCSS:{backgroundColor:"#FFFFFF",opacity:.8,cursor:"wait"}});var c={action:yith_shippo_order_meta_box_params.actions.updateRate,security:yith_shippo_order_meta_box_params.nonces.updateRate,rate:a,parcel:r,rate_key:p,order_id:e};i.ajax({type:"POST",url:yith_shippo_order_meta_box_params.ajaxurl,data:c,dataType:"json",success:function(t){if(void 0!==t.updated&&t.updated){var e=o.find("img").attr("src"),p=o.find(".yith-shippo-service-popup--name").html(),r=o.find(".yith-shippo-service-popup--price").html(),s="";o.find(".yith-shippo-service-popup--days").length&&(s=o.find(".yith-shippo-service-popup--days").html());var h=n.find(".yith-shippo-choose-service-wrap");if(h.find("img").length)h.find("img").attr("src",e);else{var c=i("<img>");c.attr("src",e),h.find(".yith-shippo-service-image").append(c)}h.find(".yith-shippo-service-label .yith-shippo-service-label-first").html(p),h.find(".yith-shippo-service-label .yith-shippo-service-label-price strong").html(r),h.find(".yith-shippo-service-days").html(s),h.find(".yith-shippo-service-id").val(a.service),""===s?h.find(".yith-shippo-service-days").hide():h.find(".yith-shippo-service-days").show(),h.find(".yith-shippo-service-content").removeClass("hide"),h.find(".yith-shippo-service-empty-state-wrapper").addClass("hide")}},complete:function(){null!==typeof h&&h.close(),s.unblock()}})})),i(document).on("change",".yith-shippo-shipping-section-box :input",(function(t){var e=i(this).parents(".yith-shippo-shipping-section-box"),o=e.data("rate-key");n[o]="",e.find(".yith-shippo-service-id").val(""),e.find(".yith-shippo-service-content").addClass("hide"),e.find(".yith-shippo-service-empty-state-wrapper").removeClass("hide")})),i(document).on("change","select.yith-shippo-package",(function(e){var o,p,a=i(this).parents(".yith-shippo-parcel-info"),r=a.data("parcels"),s=i(this).val();if(void 0!==r[s]){a.find(".yith-parcel-length").val(r[s].length),a.find(".yith-parcel-width").val(r[s].width),a.find(".yith-parcel-height").val(r[s].height),a.find(".yith-parcel-weight").val(r[s].weight);var n=""===r[s].weight?1:parseFloat(r[s].weight),h=(o=a.parent().find(".yith-shippo-producs-shipping-list .yith-shippo-product-shipping--row"),p=0,o.each((function(e,o){var a=i(o).find("select.yith-shippo-product-list").val(),r=i(o).find("input.yith-product-qty").val(),s=0;void 0!==t[a]&&(s=t[a].weight),p+=parseFloat(s)*parseInt(r)})),p);a.find(".total_weight_value").html(parseFloat(n)+h)}})).trigger("change"),i(document).on("click",".yith-shippo-delete-shipping",(function(t){t.preventDefault();var e=i(this).parents(".yith-shippo-shipping-section-box"),o=e.data("rate-key"),p={action:yith_shippo_order_meta_box_params.actions.deleteShipping,security:yith_shippo_order_meta_box_params.nonces.deleteShipping,order_id:i("#yith-shippo-order-meta-box").data("order_id"),rate_key:o},a={message:null,overlayCSS:{background:"#fff",opacity:.6}};yith.ui.confirm({title:yith_shippo_order_meta_box_params.confirmDelete.title,message:yith_shippo_order_meta_box_params.confirmDelete.message,confirmButtonType:"delete",confirmButton:yith_shippo_order_meta_box_params.confirmDelete.confirmButton,closeAfterConfirm:!0,onConfirm:function(){i("#yith-shippo-order-meta-box").block(a),i.ajax({type:"POST",url:yith_shippo_order_meta_box_params.ajaxurl,data:p,dataType:"json",success:function(t){i("#yith-shippo-order-meta-box").unblock(),void 0!==t.deleted&&t.deleted&&e.remove()}})}})})),i(document).on("click",".yith-shippo-create-shipment",(function(t){t.preventDefault();var e=i(this).parents(".yith-shippo-shipping-section-box"),p=e.find(".yith-shippo-service-id").val(),a=e.data("rate-key");if(""===p)o(yith_shippo_order_meta_box_params.errorconfirmShipment.title,yith_shippo_order_meta_box_params.errorconfirmShipment.message);else{var r={action:yith_shippo_order_meta_box_params.actions.createShipment,security:yith_shippo_order_meta_box_params.nonces.createShipment,order_id:i("#yith-shippo-order-meta-box").data("order_id"),rate_key:a},s={message:null,overlayCSS:{background:"#fff",opacity:.6}};yith.ui.confirm({title:yith_shippo_order_meta_box_params.confirmShipment.title,message:yith_shippo_order_meta_box_params.confirmShipment.message,confirmButtonType:"confirm",confirmButton:yith_shippo_order_meta_box_params.confirmShipment.confirmButton,closeAfterConfirm:!0,onConfirm:function(){i("#yith-shippo-order-meta-box").block(s),i.ajax({type:"POST",url:yith_shippo_order_meta_box_params.ajaxurl,data:r,dataType:"json",success:function(t){if(i("#yith-shippo-order-meta-box").unblock(),t.success)e.find(".yith-shippo-shipping-section-box--content").html(t.data),i(document).trigger("yith-plugin-fw-tips-init");else{var p="";i.each(t.data,(function(i,t){p+="<li>"+t.message+"</li>"})),p="<ul>"+p+"</ul>",o(yith_shippo_order_meta_box_params.confirmShipment.title_error,p)}}})}})}})),i(document).on("click",".yith-shippo-pay-shipping",(function(t){t.preventDefault();var e=i(this).parents(".yith-shippo-shipping-section-box"),p=e.data("rate-key"),a={action:yith_shippo_order_meta_box_params.actions.payShipping,security:yith_shippo_order_meta_box_params.nonces.payShipping,order_id:i("#yith-shippo-order-meta-box").data("order_id"),rate_key:p},r={message:null,overlayCSS:{background:"#fff",opacity:.6}};yith.ui.confirm({title:yith_shippo_order_meta_box_params.confirmPay.title,message:yith_shippo_order_meta_box_params.confirmPay.message,confirmButtonType:"confirm",confirmButton:yith_shippo_order_meta_box_params.confirmPay.confirmButton,closeAfterConfirm:!0,onConfirm:function(){i("#yith-shippo-order-meta-box").block(r),i.ajax({type:"POST",url:yith_shippo_order_meta_box_params.ajaxurl,data:a,dataType:"json",success:function(t){if(i("#yith-shippo-order-meta-box").unblock(),t.success)e.find(".yith-shippo-shipping-section-box--content").html(t.data);else{var p="";i.each(t.data,(function(i,t){p+="<li>"+t.message+"</li>"})),p="<ul>"+p+"</ul>",o(yith_shippo_order_meta_box_params.confirmPay.title_error,p)}}})}})}))})).trigger("yith-shippo-metabox-init"),i(document).on("click",".yith-shippo-tracking-history-view-detail",(function(t){t.preventDefault();var e=i(this),o=e.closest(".yith-shippo-shipping-tracking-history").find(".yith-shippo-tracking-history-list"),p=0;o.hasClass("opened")?(o.removeClass("opened"),p=0):(o.addClass("opened"),p=-180),o.toggle("slow"),e.find("i").css({"-webkit-transform":"rotate("+p+"deg)","-moz-transform":"rotate("+p+"deg)","-ms-transform":"rotate("+p+"deg)",transform:"rotate("+p+"deg)"})}))}));