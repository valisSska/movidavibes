!function(e){if("undefined"!=typeof woocommerce_admin_meta_boxes){var o={init:function(){var o=e("#woocommerce-order-items"),t=o.find("tr.partial-payment");o.on("click","button.void-authorization",this.void_authorization).on("click",".button.partial-payment",this.show_section).on("change keyup","#partial_payment_amount",this.amount_changed).on("click","button.do-partial-payment",this.do_payment).on("click","button.cancel",this.cancel),t.length&&o.on("click","button.refund-items",this.refund_partials).on("change",".refund input.refund_partial",this.refund_input_changed).on("click","button.do-api-refund, button.do-manual-refund",this.do_refund)},block:function(){e("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){e("#woocommerce-order-items").unblock()},do_request:function(t){e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:t,type:"POST",success:function(e){"success"===e.result?window.location.reload():(window.alert(e.error),o.unblock())}})},void_authorization:function(){o.block(),window.confirm(yith_ppwc_partial_payment.void_confirm)?o.do_request({action:yith_ppwc_partial_payment.ajaxAction,security:yith_ppwc_partial_payment.ajaxNonce,request:"void_payment_authorization",order_id:woocommerce_admin_meta_boxes.post_id}):o.unblock()},show_section:function(){if(!e("div.wc-order-partial-payment").length){var o=e(this).closest(".wc-order-data-row"),t=wp.template("yith-ppwc-partial-payment");o.after(t({})).hide()}return e("div.wc-order-partial-payment").slideDown(),e("div.wc-order-data-row-toggle").not("div.wc-order-partial-payment").slideUp(),e("div.wc-order-totals-items").slideUp(),e(".wc-order-edit-line-item .wc-order-edit-line-item-actions").hide(),!1},amount_changed:function(){var o=accounting.unformat(e(this).val(),woocommerce_admin.mon_decimal_point);e("button .wc-order-partial-amount .amount").text(accounting.formatMoney(o,{symbol:woocommerce_admin_meta_boxes.currency_format_symbol,decimal:woocommerce_admin_meta_boxes.currency_format_decimal_sep,thousand:woocommerce_admin_meta_boxes.currency_format_thousand_sep,precision:woocommerce_admin_meta_boxes.currency_format_num_decimals,format:woocommerce_admin_meta_boxes.currency_format}))},do_payment:function(){if(o.block(),window.confirm(yith_ppwc_partial_payment.do_payment_confirm)){var t=e("input#partial_payment_amount").val(),a=e("input#partial_payed_amount").val();o.do_request({action:yith_ppwc_partial_payment.ajaxAction,security:yith_ppwc_partial_payment.ajaxNonce,request:"partial_payment",order_id:woocommerce_admin_meta_boxes.post_id,payment_amount:t,payed_amount:a})}else o.unblock()},cancel:function(){return e("div.wc-order-partial-payment").slideUp(),e("div.wc-order-totals-items, div.wc-order-bulk-actions").slideDown(),e(".wc-order-edit-line-item .wc-order-edit-line-item-actions").show(),!1},refund_partials:function(o){o.stopImmediatePropagation(),e("div.wc-order-refund-items").slideDown(),e("div.wc-order-data-row-toggle").not("div.wc-order-refund-items").slideUp(),e("div.wc-order-totals-items").slideUp(),e("#woocommerce-order-items").find("tr.partial-payment div.refund").show(),e(".wc-order-edit-line-item .wc-order-edit-line-item-actions").hide(),e('label[for="restock_refunded_items"]').closest("tr").hide(),e("input#refund_amount").attr("readonly","readonly");var t=0;e('input[name="order_partial_amount_remaining"]').each((function(e,o){t+=parseFloat(accounting.formatNumber(o.value,woocommerce_admin_meta_boxes.currency_format_num_decimals,"",woocommerce_admin.mon_decimal_point))})),e('label[for="refund_amount"]').closest("tr").prev().find("span.amount").text(accounting.formatMoney(t,{symbol:woocommerce_admin_meta_boxes.currency_format_symbol,decimal:woocommerce_admin_meta_boxes.currency_format_decimal_sep,thousand:woocommerce_admin_meta_boxes.currency_format_thousand_sep,precision:woocommerce_admin_meta_boxes.currency_format_num_decimals,format:woocommerce_admin_meta_boxes.currency_format}))},refund_input_changed:function(){var o=0;e(".woocommerce_order_items").find("tr.partial-payment").each((function(){e(this).find(".refund input").each((function(t,a){o+=parseFloat(accounting.unformat(e(a).val()||0,woocommerce_admin.mon_decimal_point))}))})),e("#refund_amount").val(accounting.formatNumber(o,woocommerce_admin_meta_boxes.currency_format_num_decimals,"",woocommerce_admin.mon_decimal_point)).change()},do_refund:function(t){if(t.stopImmediatePropagation(),o.block(),window.confirm(woocommerce_admin_meta_boxes.i18n_do_refund)){var a=e("input#refund_amount").val(),n=e("input#refund_reason").val(),i=e("input#refunded_amount").val(),r={};e(".refund input.refund_partial").each((function(o,t){e(t).closest("tr").data("order_partial_id")&&(r[e(t).closest("tr").data("order_partial_id")]=accounting.unformat(t.value,woocommerce_admin.mon_decimal_point))})),o.do_request({action:yith_ppwc_partial_payment.ajaxAction,security:yith_ppwc_partial_payment.ajaxNonce,request:"partial_payment_refund",order_id:woocommerce_admin_meta_boxes.post_id,refund_amount:a,refunded_amount:i,refund_reason:n,partial_items:JSON.stringify(r,null,""),api_refund:e(this).is(".do-api-refund")})}else o.unblock()}};o.init()}}(jQuery);